<html>
    <head>
	       <title>W06: Task 01</title>
           <script type="x-shader/x-vertex" id="blinn_phong.vert">
           attribute vec3 inputPosition;
           attribute vec2 inputTexCoord;
           attribute vec3 inputNormal;

           uniform mat4 projection, modelview, normalMat;

           varying vec3 normalInterp;
           varying vec3 vertPos;

           void main(){
               gl_Position = projection * modelview * vec4(inputPosition, 1.0);
               vec4 vertPos4 = modelview * vec4(inputPosition, 1.0);
               vertPos = vec3(vertPos4) / vertPos4.w;
               normalInterp = vec3(normalMat * vec4(inputNormal, 0.0));
           }
           </script>
           <script type="x-shader/x-fragment" id="blinn_phong.frag">
            precision mediump float;

            varying vec3 normalInterp;
            varying vec3 vertPos;

            uniform int mode;

            const vec3 lightPos = vec3(1.0,1.0,1.0);
            const vec3 ambientColor = vec3(0.1, 0.0, 0.0);
            const vec3 diffuseColor = vec3(0.5, 0.0, 0.0);
            const vec3 specColor = vec3(1.0, 1.0, 1.0);

            void main() {

              vec3 normal = normalize(normalInterp);
              vec3 lightDir = normalize(lightPos - vertPos);

              float lambertian = max(dot(lightDir,normal), 0.0);
              float specular = 0.0;

              if(lambertian > 0.0) {

                vec3 viewDir = normalize(-vertPos);

                // this is blinn phong
                vec3 halfDir = normalize(lightDir + viewDir);
                float specAngle = max(dot(halfDir, normal), 0.0);
                specular = pow(specAngle, 16.0);

                // this is phong (for comparison)
                if(mode == 2) {
                  vec3 reflectDir = reflect(-lightDir, normal);
                  specAngle = max(dot(reflectDir, viewDir), 0.0);
                  // note that the exponent is different here
                  specular = pow(specAngle, 4.0);
                }
              }

              gl_FragColor = vec4(ambientColor +
                                  lambertian * diffuseColor +
                                  specular * specColor, 1.0);
              }
           </script>

           <script type="x-shader/x-vertex" id="gouraud.vert">
               varying vec3 point_color;
               varying vec4 point_position;
               varying vec3 normal_vector;
               uniform vec3 light_position;

               vec3 LambertianReflection( vec3 C, vec3 L, vec3 N )
                {
                    float ka = 0.4;
                    float kd = 0.6;
                    float dd = max( dot( N, L ), 0.0 );
                    float Ia = ka;
                    float Id = kd * dd;
                    return C * ( Ia + Id );
                }

               void main()
               {
                   point_position = modelViewMatrix * vec4( position, 1.0 );
                   normal_vector = normalMatrix * normal;
                   vec3 C = color;
                   vec3 L = normalize( light_position - point_position.xyz );
                   vec3 N = normalize( normal_vector );
                   point_color = LambertianReflection( C, L, N );
                   gl_Position = projectionMatrix * point_position;
               }
           </script>
           <script type="x-shader/x-fragment" id="gouraud.frag">
               varying vec3 point_color;

               void main() {
                   gl_FragColor = vec4( point_color, 1.0);
               }
           </script>
    </head>
    <body>
	       <script src="https://threejs.org/build/three.min.js"></script>
      	 <script src="main03.js"></script>
      	 <script>
      	   main();
      	 </script>
    </body>
</html>
